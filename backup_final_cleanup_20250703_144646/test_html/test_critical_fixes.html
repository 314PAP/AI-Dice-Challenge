<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Critical Issues Fix Test</title>
    <link rel="stylesheet" href="/src/styles/main.css">
    <style>
        .test-container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: var(--black-bg);
            border: 1px solid var(--neon-orange);
            border-radius: 10px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
        }
        
        .test-section h3 {
            color: var(--neon-green);
            margin-bottom: 10px;
        }
        
        .issue-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-fixed { background: rgba(57, 255, 20, 0.2); color: var(--neon-green); }
        .status-testing { background: rgba(255, 140, 0, 0.2); color: var(--neon-orange); }
        .status-broken { background: rgba(255, 20, 147, 0.2); color: var(--neon-pink); }
        
        .dice-test-area {
            display: flex;
            flex-wrap: nowrap;
            gap: 8px;
            padding: 10px;
            border: 1px solid var(--neon-green);
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .test-dice {
            width: 40px;
            height: 40px;
            background: var(--black-bg);
            border: 1px solid var(--neon-green);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neon-green);
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .test-dice.banked {
            opacity: 0.5;
            border-color: var(--neon-blue);
        }
        
        .controls-test {
            position: relative;
            padding: 20px;
            border: 1px solid var(--neon-orange);
            border-radius: 5px;
            min-height: 100px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .modal-demo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--black-bg);
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            padding: 20px;
            z-index: 1000;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 999;
        }
        
        .hidden { display: none; }
    </style>
</head>
<body class="app-container">
    <div class="test-container">
        <h1>üîß Critical Issues Fix Test</h1>
        <p>Testov√°n√≠ v≈°ech reportovan√Ωch probl√©m≈Ø a jejich ≈ôe≈°en√≠</p>
        
        <!-- Issue 1: Hot Dice Display Problem -->
        <div class="test-section">
            <h3>1. Hot Dice - Zobrazov√°n√≠ star√Ωch kostek 
                <span class="issue-status status-testing">TESTING</span>
            </h3>
            <p><strong>Probl√©m:</strong> Po odlo≈æen√≠ v≈°ech kostek se st√°le zobrazuj√≠ kostky z p≈ôedchoz√≠ho tahu</p>
            <p><strong>Fix:</strong> Vymaz√°n√≠ bankedDiceThisTurn + optimalizovan√© clearDiceState()</p>
            
            <div id="hotDiceTest">
                <div class="dice-test-area" id="diceTestArea">
                    <!-- Will be populated by test -->
                </div>
                <div class="test-buttons">
                    <button class="btn btn-primary" onclick="simulateHotDice()">üî• Simulace Hot Dice</button>
                    <button class="btn btn-secondary" onclick="resetDiceTest()">üîÑ Reset</button>
                </div>
                <div id="hotDiceResult" style="margin-top: 10px; color: var(--neon-orange);"></div>
            </div>
        </div>
        
        <!-- Issue 2: Layout Problem -->
        <div class="test-section">
            <h3>2. Layout - Kostky vytv√°≈ô√≠ nov√Ω ≈ô√°dek 
                <span class="issue-status status-testing">TESTING</span>
            </h3>
            <p><strong>Probl√©m:</strong> V√≠ce kostek zp≈Øsobuje wrap a tlaƒç√≠tka miz√≠ z obrazovky</p>
            <p><strong>Fix:</strong> flex-wrap: nowrap + overflow-x: auto + flex-shrink: 0</p>
            
            <div class="dice-test-area" id="layoutTestArea">
                <!-- 12 dice to test overflow -->
            </div>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testLayout()">üì± Test Layout (12 kostek)</button>
                <button class="btn btn-secondary" onclick="clearLayoutTest()">üóëÔ∏è Clear</button>
            </div>
        </div>
        
        <!-- Issue 3: Modal Navigation -->
        <div class="test-section">
            <h3>3. Modal navigace - S√≠≈à sl√°vy navracen√≠ 
                <span class="issue-status status-testing">TESTING</span>
            </h3>
            <p><strong>Probl√©m:</strong> Po kliknut√≠ na S√≠≈à sl√°vy se vrac√≠ do ukonƒçen√© hry m√≠sto z≈Øst√°n√≠ v S√≠ni sl√°vy</p>
            <p><strong>Fix:</strong> hallOfFameFromGameOver flag + spr√°vn√° logika p≈ôechod≈Ø</p>
            
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testGameOverModal()">üéÆ Game Over Modal</button>
                <button class="btn btn-success" onclick="testHallOfFame()">üèÜ Hall of Fame</button>
                <button class="btn btn-secondary" onclick="hideModals()">‚ùå Hide All</button>
            </div>
        </div>
        
        <!-- Issue 4: Controls Visibility -->
        <div class="test-section">
            <h3>4. Ovl√°dac√≠ tlaƒç√≠tka - Viditelnost 
                <span class="issue-status status-testing">TESTING</span>
            </h3>
            <p><strong>Probl√©m:</strong> Tlaƒç√≠tka se posunou mimo obraz p≈ôi probl√©mech s layoutem</p>
            <p><strong>Fix:</strong> Sticky positioning + proper viewport handling</p>
            
            <div class="controls-test">
                <div style="position: sticky; bottom: 0; background: var(--black-bg); padding: 10px; border-top: 1px solid var(--neon-blue);">
                    <div class="test-buttons">
                        <button class="btn btn-success">üé≤ Hodit kostkami</button>
                        <button class="btn btn-primary">üí∞ Odlo≈æit</button>
                        <button class="btn btn-secondary">‚úÖ Ukonƒçit tah</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Performance Test -->
        <div class="test-section">
            <h3>5. V√Ωkon - Lodash optimalizace 
                <span class="issue-status status-fixed">OPTIMIZED</span>
            </h3>
            <p><strong>Nov√© funkce:</strong> debounced updates, throttled animations, safe execution</p>
            
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testPerformance()">‚ö° Test Performance</button>
                <button class="btn btn-secondary" onclick="testUtilities()">üîß Test Utilities</button>
            </div>
            <div id="performanceResult" style="margin-top: 10px; color: var(--neon-green);"></div>
        </div>
    </div>

    <!-- Demo Modals -->
    <div id="demoOverlay" class="modal-overlay hidden"></div>
    
    <div id="demoGameOver" class="modal-demo hidden">
        <h3 style="color: var(--neon-orange);">üéÆ Konec hry</h3>
        <p>Gratulujeme! Vyhr√°li jste!</p>
        <div class="test-buttons">
            <button class="btn btn-primary" onclick="showHallFromGameOver()">üèÜ S√≠≈à sl√°vy</button>
            <button class="btn btn-secondary" onclick="hideModals()">‚ùå Zav≈ô√≠t</button>
        </div>
    </div>
    
    <div id="demoHallOfFame" class="modal-demo hidden">
        <h3 style="color: var(--neon-green);">üèÜ S√≠≈à sl√°vy</h3>
        <p>Nejlep≈°√≠ v√Ωsledky...</p>
        <div class="test-buttons">
            <button class="btn btn-primary" onclick="backToGameOver()">üîô Zpƒõt</button>
            <button class="btn btn-success" onclick="newGameFromHall()">üéÆ Nov√° hra</button>
            <button class="btn btn-secondary" onclick="hideModals()">üè† Menu</button>
        </div>
    </div>

    <script type="module">
        import { clearDiceState, debouncedUpdateUI, throttledDiceAnimation, toggleModal, safeExecute } from '/src/js/utils/gameUtils.js';
        
        let testGameState = {
            diceValues: [],
            selectedDice: [],
            bankedDiceThisTurn: [],
            availableDice: 6,
            mustBankDice: false
        };
        
        let fromGameOver = false;
        
        // Test 1: Hot Dice
        window.simulateHotDice = function() {
            const result = document.getElementById('hotDiceResult');
            result.innerHTML = 'üî• Simuluji Hot Dice scenario...';
            
            // Step 1: Setup dice with banked dice
            testGameState.diceValues = [1, 2, 3];
            testGameState.bankedDiceThisTurn = [5, 5, 1];
            testGameState.availableDice = 0;
            
            updateDiceDisplay();
            result.innerHTML += '<br>1. Setup: 3 nov√© kostky + 3 odlo≈æen√©';
            
            setTimeout(() => {
                // Step 2: Trigger Hot Dice
                if (testGameState.availableDice === 0) {
                    testGameState.availableDice = 6;
                    clearDiceState(testGameState);
                    result.innerHTML += '<br>2. Hot Dice activated - clearDiceState() called';
                    
                    setTimeout(() => {
                        updateDiceDisplay();
                        const success = testGameState.diceValues.length === 0 && 
                                      testGameState.bankedDiceThisTurn.length === 0;
                        result.innerHTML += `<br>3. Result: ${success ? '‚úÖ SUCCESS' : '‚ùå FAILED'} - Display cleared`;
                    }, 200);
                }
            }, 1000);
        };
        
        window.resetDiceTest = function() {
            testGameState = {
                diceValues: [],
                selectedDice: [],
                bankedDiceThisTurn: [],
                availableDice: 6,
                mustBankDice: false
            };
            updateDiceDisplay();
            document.getElementById('hotDiceResult').innerHTML = '';
        };
        
        // Test 2: Layout
        window.testLayout = function() {
            const area = document.getElementById('layoutTestArea');
            area.innerHTML = '';
            
            // Create 12 dice to test overflow
            for (let i = 1; i <= 12; i++) {
                const die = document.createElement('div');
                die.className = 'test-dice';
                die.textContent = (i % 6) + 1;
                if (i > 6) die.classList.add('banked');
                area.appendChild(die);
            }
        };
        
        window.clearLayoutTest = function() {
            document.getElementById('layoutTestArea').innerHTML = '';
        };
        
        // Test 3: Modals
        window.testGameOverModal = function() {
            fromGameOver = false;
            toggleModal('demoGameOver', true);
            document.getElementById('demoOverlay').classList.remove('hidden');
        };
        
        window.testHallOfFame = function() {
            fromGameOver = false;
            toggleModal('demoHallOfFame', true);
            document.getElementById('demoOverlay').classList.remove('hidden');
        };
        
        window.showHallFromGameOver = function() {
            fromGameOver = true;
            toggleModal('demoGameOver', false);
            setTimeout(() => {
                toggleModal('demoHallOfFame', true);
            }, 300);
        };
        
        window.backToGameOver = function() {
            if (fromGameOver) {
                toggleModal('demoHallOfFame', false);
                setTimeout(() => {
                    toggleModal('demoGameOver', true);
                }, 300);
            } else {
                hideModals();
            }
        };
        
        window.newGameFromHall = function() {
            hideModals();
            alert('üéÆ Nov√° hra spu≈°tƒõna!');
        };
        
        window.hideModals = function() {
            toggleModal('demoGameOver', false);
            toggleModal('demoHallOfFame', false);
            document.getElementById('demoOverlay').classList.add('hidden');
            fromGameOver = false;
        };
        
        // Test 4: Performance
        window.testPerformance = function() {
            const result = document.getElementById('performanceResult');
            const start = performance.now();
            
            // Test debounced function
            for (let i = 0; i < 100; i++) {
                debouncedUpdateUI(() => console.log('Update'));
            }
            
            // Test throttled function
            for (let i = 0; i < 100; i++) {
                throttledDiceAnimation(() => console.log('Animation'));
            }
            
            const end = performance.now();
            result.innerHTML = `‚ö° Performance test completed in ${(end - start).toFixed(2)}ms<br>‚úÖ Debounced/throttled functions working`;
        };
        
        window.testUtilities = function() {
            const result = document.getElementById('performanceResult');
            
            const tests = [
                () => safeExecute(() => 'test', null, 'TestContext'),
                () => clearDiceState(testGameState),
                () => toggleModal('nonExistent', true)
            ];
            
            const results = tests.map(test => {
                try {
                    test();
                    return '‚úÖ';
                } catch (e) {
                    return '‚ùå';
                }
            });
            
            result.innerHTML = `üîß Utility tests: ${results.join(' ')} - ${results.filter(r => r === '‚úÖ').length}/${results.length} passed`;
        };
        
        // Helper function
        function updateDiceDisplay() {
            const area = document.getElementById('diceTestArea');
            area.innerHTML = '';
            
            // Show banked dice
            testGameState.bankedDiceThisTurn.forEach(value => {
                const die = document.createElement('div');
                die.className = 'test-dice banked';
                die.textContent = value;
                area.appendChild(die);
            });
            
            // Show current dice
            testGameState.diceValues.forEach(value => {
                const die = document.createElement('div');
                die.className = 'test-dice';
                die.textContent = value;
                area.appendChild(die);
            });
        }
        
        // Click overlay to close
        document.getElementById('demoOverlay').addEventListener('click', hideModals);
        
        // Initial layout test
        testLayout();
    </script>
</body>
</html>
