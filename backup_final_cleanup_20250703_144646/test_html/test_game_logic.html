<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ² Test HernÃ­ Logiky - AI KostkovÃ¡ VÃ½zva</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #111;
            color: #0f0;
            padding: 20px;
            margin: 0;
        }
        .test-section {
            border: 1px solid #0f0;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .test-passed {
            background: rgba(0, 255, 0, 0.1);
            border-color: #0f0;
        }
        .test-failed {
            background: rgba(255, 0, 0, 0.1);
            border-color: #f00;
            color: #f00;
        }
        .dice-test {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .dice {
            width: 50px;
            height: 50px;
            border: 2px solid #0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            background: #222;
        }
        .dice.selected {
            background: #0f0;
            color: #000;
        }
        .dice.scoring {
            border-color: #ff0;
            color: #ff0;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
        }
        #log {
            background: #000;
            border: 1px solid #0f0;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            font-size: 12px;
        }
        .controls {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ² Test HernÃ­ Logiky - AI KostkovÃ¡ VÃ½zva</h1>
    
    <div class="test-section" id="importTest">
        <h3>ğŸ“¦ Test importÅ¯ modulÅ¯</h3>
        <div id="importResults">TestovÃ¡nÃ­...</div>
    </div>
    
    <div class="test-section" id="gameStateTest">
        <h3>ğŸ® Test hernÃ­ho stavu</h3>
        <div id="gameStateResults">TestovÃ¡nÃ­...</div>
    </div>
    
    <div class="test-section" id="diceTest">
        <h3>ğŸ² Test kostek a vÃ½bÄ›ru</h3>
        <div class="controls">
            <button onclick="testDiceRoll()">ğŸ² Test hodu kostek</button>
            <button onclick="testDiceSelection()">âœ‹ Test vÃ½bÄ›ru kostek</button>
            <button onclick="testBankDice()">ğŸ’° Test odloÅ¾enÃ­ kostek</button>
        </div>
        <div id="diceContainer" class="dice-test"></div>
        <div id="diceResults">PÅ™ipraven na testovÃ¡nÃ­...</div>
    </div>
    
    <div class="test-section" id="chatTest">
        <h3>ğŸ’¬ Test chatu</h3>
        <div class="controls">
            <button onclick="testChat()">ğŸ’¬ Test chat zprÃ¡vy</button>
        </div>
        <div id="chatResults">PÅ™ipraven na testovÃ¡nÃ­...</div>
    </div>
    
    <div class="test-section" id="gameFlowTest">
        <h3>ğŸ”„ Test hernÃ­ho toku</h3>
        <div class="controls">
            <button onclick="testGameStart()">â–¶ï¸ Test spuÅ¡tÄ›nÃ­ hry</button>
            <button onclick="testTurnEnd()">â­ï¸ Test konce tahu</button>
            <button onclick="testGameReset()">ğŸ”„ Test reset hry</button>
        </div>
        <div id="gameFlowResults">PÅ™ipraven na testovÃ¡nÃ­...</div>
    </div>
    
    <div id="log"></div>

    <script type="module">
        // Simulace game state pro test
        let testGameState = {
            currentPlayer: 0,
            diceValues: [],
            selectedDice: [],
            availableDice: 6,
            mustBankDice: false,
            gameStarted: false,
            players: [
                { name: 'HrÃ¡Ä', score: 0, type: 'human' },
                { name: 'Gemini', score: 0, type: 'gemini' },
                { name: 'ChatGPT', score: 0, type: 'chatgpt' },
                { name: 'Claude', score: 0, type: 'claude' }
            ]
        };

        function log(message) {
            const logElement = document.getElementById('log');
            logElement.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function setTestResult(sectionId, passed, message) {
            const section = document.getElementById(sectionId);
            const resultDiv = document.getElementById(sectionId.replace('Test', 'Results'));
            
            if (passed) {
                section.className = 'test-section test-passed';
                resultDiv.innerHTML = `âœ… ${message}`;
            } else {
                section.className = 'test-section test-failed';
                resultDiv.innerHTML = `âŒ ${message}`;
            }
            log(`${sectionId}: ${passed ? 'PASSED' : 'FAILED'} - ${message}`);
        }

        // Test importÅ¯
        async function testImports() {
            try {
                log('ğŸ” TestovÃ¡nÃ­ importÅ¯...');
                
                const { gameState } = await import('./src/js/game/gameState.js');
                const { rollDice, calculateScore } = await import('./src/js/game/diceLogic.js');
                const { rollDiceForPlayer, selectDie, bankSelectedDice } = await import('./src/js/game/controllers/turnActionsController.js');
                
                log('âœ… VÅ¡echny moduly ÃºspÄ›Å¡nÄ› importovÃ¡ny');
                setTestResult('importTest', true, 'VÅ¡echny potÅ™ebnÃ© moduly jsou dostupnÃ©');
                
                // UloÅ¾Ã­me reference pro dalÅ¡Ã­ testy
                window.testModules = {
                    gameState,
                    rollDice,
                    calculateScore,
                    rollDiceForPlayer,
                    selectDie,
                    bankSelectedDice
                };
                
                return true;
            } catch (error) {
                log(`âŒ Chyba pÅ™i importovÃ¡nÃ­: ${error.message}`);
                setTestResult('importTest', false, `Chyba importu: ${error.message}`);
                return false;
            }
        }

        // Test hernÃ­ho stavu
        function testGameState() {
            try {
                const { gameState } = window.testModules;
                
                log('ğŸ” TestovÃ¡nÃ­ hernÃ­ho stavu...');
                log(`Current player: ${gameState.currentPlayer}`);
                log(`Game started: ${gameState.gameStarted}`);
                log(`Available dice: ${gameState.availableDice}`);
                
                setTestResult('gameStateTest', true, `HernÃ­ stav je dostupnÃ½. AktuÃ¡lnÃ­ hrÃ¡Ä: ${gameState.currentPlayer}`);
                return true;
            } catch (error) {
                log(`âŒ Chyba v hernÃ­m stavu: ${error.message}`);
                setTestResult('gameStateTest', false, `Chyba hernÃ­ho stavu: ${error.message}`);
                return false;
            }
        }

        // Test hodu kostek
        window.testDiceRoll = function() {
            try {
                const { rollDice, calculateScore } = window.testModules;
                
                log('ğŸ² TestovÃ¡nÃ­ hodu kostek...');
                const diceResults = rollDice(5);
                const diceValues = diceResults.map(d => d.value);
                
                log(`Hod: ${diceValues.join(', ')}`);
                
                const score = calculateScore(diceValues);
                log(`MoÅ¾nÃ© body: ${score}`);
                
                // Aktualizuj test state
                testGameState.diceValues = diceValues;
                testGameState.selectedDice = [];
                testGameState.mustBankDice = score > 0;
                
                // Zobraz kostky
                displayTestDice(diceValues);
                
                setTestResult('diceTest', true, `Hod: [${diceValues.join(', ')}], MoÅ¾nÃ© body: ${score}`);
            } catch (error) {
                log(`âŒ Chyba pÅ™i hodu kostek: ${error.message}`);
                setTestResult('diceTest', false, `Chyba hodu: ${error.message}`);
            }
        };

        // ZobrazenÃ­ kostek pro test
        function displayTestDice(diceValues) {
            const container = document.getElementById('diceContainer');
            container.innerHTML = '';
            
            diceValues.forEach((value, index) => {
                const dieElement = document.createElement('div');
                dieElement.className = 'dice';
                dieElement.textContent = value;
                dieElement.onclick = () => testSelectDie(index);
                
                const { calculateScore } = window.testModules;
                if (calculateScore([value]) > 0) {
                    dieElement.classList.add('scoring');
                }
                
                container.appendChild(dieElement);
            });
        }

        // Test vÃ½bÄ›ru kostky
        function testSelectDie(index) {
            log(`ğŸ¯ VÃ½bÄ›r kostky ${index} (hodnota: ${testGameState.diceValues[index]})`);
            
            if (testGameState.selectedDice.includes(index)) {
                testGameState.selectedDice = testGameState.selectedDice.filter(i => i !== index);
                log(`Kostka ${index} odznaÄena`);
            } else {
                testGameState.selectedDice.push(index);
                log(`Kostka ${index} oznaÄena`);
            }
            
            // Aktualizuj zobrazenÃ­
            const diceElements = document.querySelectorAll('.dice');
            diceElements.forEach((element, i) => {
                if (testGameState.selectedDice.includes(i)) {
                    element.classList.add('selected');
                } else {
                    element.classList.remove('selected');
                }
            });
            
            log(`OznaÄenÃ© kostky: [${testGameState.selectedDice.join(', ')}]`);
        }

        // Test vÃ½bÄ›ru kostek
        window.testDiceSelection = function() {
            if (testGameState.diceValues.length === 0) {
                setTestResult('diceTest', false, 'Nejprve proveÄte hod kostek');
                return;
            }
            
            log('âœ‹ TestovÃ¡nÃ­ vÃ½bÄ›ru kostek...');
            log('KliknÄ›te na kostky pro jejich vÃ½bÄ›r/odznaÄenÃ­');
            setTestResult('diceTest', true, 'VÃ½bÄ›r kostek je aktivnÃ­ - kliknÄ›te na kostky');
        };

        // Test odloÅ¾enÃ­ kostek
        window.testBankDice = function() {
            try {
                if (testGameState.selectedDice.length === 0) {
                    setTestResult('diceTest', false, 'Nejprve vyberte kostky');
                    return;
                }
                
                const { calculateScore } = window.testModules;
                const selectedValues = testGameState.selectedDice.map(i => testGameState.diceValues[i]);
                const score = calculateScore(selectedValues);
                
                log(`ğŸ’° OdloÅ¾enÃ­ kostek: [${selectedValues.join(', ')}]`);
                log(`ZÃ­skanÃ© body: ${score}`);
                
                if (score > 0) {
                    testGameState.bankedDiceThisTurn = (testGameState.bankedDiceThisTurn || []).concat(selectedValues);
                    testGameState.selectedDice = [];
                    setTestResult('diceTest', true, `Kostky odloÅ¾eny za ${score} bodÅ¯`);
                } else {
                    setTestResult('diceTest', false, 'VybranÃ© kostky nemajÃ­ Å¾Ã¡dnou hodnotu');
                }
            } catch (error) {
                log(`âŒ Chyba pÅ™i odloÅ¾enÃ­ kostek: ${error.message}`);
                setTestResult('diceTest', false, `Chyba odloÅ¾enÃ­: ${error.message}`);
            }
        };

        // Test chatu
        window.testChat = function() {
            try {
                log('ğŸ’¬ TestovÃ¡nÃ­ chatu...');
                
                if (typeof window.addChatMessage === 'function') {
                    window.addChatMessage('system', 'ğŸ§ª Test zprÃ¡va ze systÃ©mu');
                    window.addChatMessage('human', 'ğŸ§ª Test zprÃ¡va od hrÃ¡Äe');
                    setTestResult('chatTest', true, 'Chat funkce je dostupnÃ¡ a funkÄnÃ­');
                } else {
                    setTestResult('chatTest', false, 'Chat funkce nenÃ­ dostupnÃ¡');
                }
            } catch (error) {
                log(`âŒ Chyba chatu: ${error.message}`);
                setTestResult('chatTest', false, `Chyba chatu: ${error.message}`);
            }
        };

        // Test spuÅ¡tÄ›nÃ­ hry
        window.testGameStart = async function() {
            try {
                log('â–¶ï¸ TestovÃ¡nÃ­ spuÅ¡tÄ›nÃ­ hry...');
                
                const { startGame } = await import('./src/js/game/controllers/gameFlowController.js');
                
                // Simulace spuÅ¡tÄ›nÃ­ hry
                log('SpouÅ¡tÄ›nÃ­ hry...');
                setTestResult('gameFlowTest', true, 'Funkce startGame je dostupnÃ¡');
            } catch (error) {
                log(`âŒ Chyba spuÅ¡tÄ›nÃ­ hry: ${error.message}`);
                setTestResult('gameFlowTest', false, `Chyba spuÅ¡tÄ›nÃ­: ${error.message}`);
            }
        };

        // Test konce tahu
        window.testTurnEnd = async function() {
            try {
                log('â­ï¸ TestovÃ¡nÃ­ konce tahu...');
                
                const { nextPlayer } = await import('./src/js/game/controllers/gameFlowController.js');
                
                log('Funkce nextPlayer je dostupnÃ¡');
                setTestResult('gameFlowTest', true, 'Funkce nextPlayer je dostupnÃ¡');
            } catch (error) {
                log(`âŒ Chyba konce tahu: ${error.message}`);
                setTestResult('gameFlowTest', false, `Chyba konce tahu: ${error.message}`);
            }
        };

        // Test reset hry
        window.testGameReset = async function() {
            try {
                log('ğŸ”„ TestovÃ¡nÃ­ resetu hry...');
                
                const { resetGame } = await import('./src/js/game/controllers/gameFlowController.js');
                
                log('Funkce resetGame je dostupnÃ¡');
                setTestResult('gameFlowTest', true, 'Funkce resetGame je dostupnÃ¡');
            } catch (error) {
                log(`âŒ Chyba resetu hry: ${error.message}`);
                setTestResult('gameFlowTest', false, `Chyba resetu: ${error.message}`);
            }
        };

        // SpuÅ¡tÄ›nÃ­ vÅ¡ech testÅ¯ pÅ™i naÄtenÃ­
        async function runAllTests() {
            log('ğŸš€ SpouÅ¡tÄ›nÃ­ testÅ¯ hernÃ­ logiky...');
            
            const importsOK = await testImports();
            if (importsOK) {
                testGameState();
            }
        }

        // SpuÅ¡tÄ›nÃ­ testÅ¯
        runAllTests();
    </script>
</body>
</html>
