<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Edge Cases</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #0a0a0a; color: #00ff41; }
        .test-section { border: 1px solid #00ff41; margin: 20px 0; padding: 15px; border-radius: 8px; }
        .test-result { margin: 10px 0; padding: 5px; border-radius: 4px; }
        .pass { background: #004400; }
        .fail { background: #440000; }
        button { background: #00ff41; color: #000; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px; cursor: pointer; }
        .scenario { background: #222; padding: 10px; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ Test Edge Cases</h1>
    
    <div class="test-section">
        <h2>Hall of Fame Edge Cases</h2>
        <button onclick="testHallOfFameScenarios()">Test Various Scenarios</button>
        <div id="hofResults"></div>
    </div>
    
    <div class="test-section">
        <h2>Game State Tests</h2>
        <button onclick="testGameState()">Test Game State Logic</button>
        <div id="gameStateResults"></div>
    </div>
    
    <div class="test-section">
        <h2>AI Decision Tests</h2>
        <button onclick="testAIDecisions()">Test AI Decision Making</button>
        <div id="aiResults"></div>
    </div>

    <script type="module">
        import { saveGameResult, getHallOfFame, clearHallOfFame, createGameResult } from './src/js/utils/hallOfFame.js';

        window.testHallOfFameScenarios = function() {
            const results = document.getElementById('hofResults');
            results.innerHTML = '';
            
            // Clear existing data
            clearHallOfFame();
            
            const scenarios = [
                {
                    name: 'Human v√≠tƒõz - rychl√° hra',
                    gameState: {
                        targetScore: 5000,
                        players: [
                            { name: 'Vy', score: 5000, type: 'human' },
                            { name: 'Gemini', score: 3000, type: 'gemini' },
                            { name: 'ChatGPT', score: 2500, type: 'chatgpt' },
                            { name: 'Claude', score: 2000, type: 'claude' }
                        ]
                    },
                    signature: 'Rychl√Ω v√≠tƒõz',
                    startTime: Date.now() - 180000, // 3 minuty
                    totalTurns: 15
                },
                {
                    name: 'AI v√≠tƒõz (Gemini) - nelze ulo≈æit',
                    gameState: {
                        targetScore: 5000,
                        players: [
                            { name: 'Vy', score: 4500, type: 'human' },
                            { name: 'Gemini', score: 5200, type: 'gemini' },
                            { name: 'ChatGPT', score: 4000, type: 'chatgpt' },
                            { name: 'Claude', score: 3800, type: 'claude' }
                        ]
                    },
                    signature: '', // Pr√°zdn√Ω podpis pro AI
                    startTime: Date.now() - 600000, // 10 minut
                    totalTurns: 35
                },
                {
                    name: 'Human v√≠tƒõz - dlouh√° hra',
                    gameState: {
                        targetScore: 10000,
                        players: [
                            { name: 'Vy', score: 10500, type: 'human' },
                            { name: 'Gemini', score: 9800, type: 'gemini' },
                            { name: 'ChatGPT', score: 9700, type: 'chatgpt' },
                            { name: 'Claude', score: 9600, type: 'claude' }
                        ]
                    },
                    signature: 'Trpƒõliv√Ω hr√°ƒç',
                    startTime: Date.now() - 1500000, // 25 minut
                    totalTurns: 80
                },
                {
                    name: 'Rem√≠za - nejvy≈°≈°√≠ sk√≥re',
                    gameState: {
                        targetScore: 5000,
                        players: [
                            { name: 'Vy', score: 5000, type: 'human' },
                            { name: 'Gemini', score: 5000, type: 'gemini' },
                            { name: 'ChatGPT', score: 4000, type: 'chatgpt' },
                            { name: 'Claude', score: 3000, type: 'claude' }
                        ]
                    },
                    signature: '≈†≈•astn√Ω remizista',
                    startTime: Date.now() - 900000, // 15 minut
                    totalTurns: 50
                }
            ];
            
            let savedCount = 0;
            
            scenarios.forEach((scenario, index) => {
                const div = document.createElement('div');
                div.className = 'scenario';
                
                const winner = scenario.gameState.players.reduce((prev, current) => 
                    (prev.score > current.score) ? prev : current);
                
                let canSave = winner.type === 'human' && scenario.signature.trim() !== '';
                let saveResult = 'N/A';
                
                if (canSave) {
                    try {
                        const gameResult = createGameResult(scenario.gameState, scenario.signature, scenario.startTime, scenario.totalTurns);
                        saveGameResult(gameResult);
                        saveResult = 'Ulo≈æeno ‚úì';
                        savedCount++;
                    } catch (error) {
                        saveResult = 'Chyba p≈ôi ukl√°d√°n√≠ ‚úó';
                    }
                } else {
                    saveResult = winner.type === 'human' ? 'Chyb√≠ podpis ‚úó' : 'AI v√≠tƒõz - neulo≈æeno ‚úì';
                }
                
                div.innerHTML = `
                    <strong>${scenario.name}</strong><br>
                    V√≠tƒõz: ${winner.name} (${winner.score} bod≈Ø)<br>
                    C√≠l: ${scenario.gameState.targetScore} | Tahy: ${scenario.totalTurns}<br>
                    Doba: ${Math.floor((Date.now() - scenario.startTime) / 60000)}m<br>
                    Ukl√°d√°n√≠: ${saveResult}
                `;
                results.appendChild(div);
            });
            
            // Zobrazit v√Ωsledky s√≠nƒõ sl√°vy
            const savedGames = getHallOfFame();
            const summary = document.createElement('div');
            summary.innerHTML = `<br><strong>Celkem ulo≈æeno: ${savedGames.length} z√°znam≈Ø</strong>`;
            results.appendChild(summary);
            
            if (savedGames.length > 0) {
                const hallDiv = document.createElement('div');
                hallDiv.innerHTML = '<h3>S√≠≈à sl√°vy:</h3>' + 
                    savedGames.map((game, i) => 
                        `${i+1}. ${game.winner} (${game.signature}) - ${game.winnerScore}/${game.targetScore} bod≈Ø`
                    ).join('<br>');
                results.appendChild(hallDiv);
            }
        };

        window.testGameState = function() {
            const results = document.getElementById('gameStateResults');
            results.innerHTML = '';
            
            const tests = [
                {
                    name: 'Validace vstupn√≠ho sk√≥re',
                    test: () => {
                        const validScores = [300, 350, 500, 1000];
                        const invalidScores = [0, 100, 250, 299];
                        
                        const validResults = validScores.every(score => score >= 300);
                        const invalidResults = invalidScores.every(score => score < 300);
                        
                        return validResults && invalidResults;
                    }
                },
                {
                    name: 'Test fin√°ln√≠ho kola',
                    test: () => {
                        const targetScore = 5000;
                        const scores = [5000, 5500, 4999, 4500];
                        
                        const shouldTrigger = scores.filter(score => score >= targetScore);
                        const shouldNotTrigger = scores.filter(score => score < targetScore);
                        
                        return shouldTrigger.length === 2 && shouldNotTrigger.length === 2;
                    }
                },
                {
                    name: 'Hot Dice logika',
                    test: () => {
                        // Test r≈Øzn√Ωch poƒçt≈Ø odlo≈æen√Ωch kostek
                        const tests = [
                            { banked: 6, expected: true },
                            { banked: 5, expected: false },
                            { banked: 3, expected: false },
                            { banked: 0, expected: false }
                        ];
                        
                        return tests.every(t => (t.banked === 6) === t.expected);
                    }
                }
            ];
            
            let passed = 0;
            
            tests.forEach(test => {
                const result = test.test();
                if (result) passed++;
                
                const div = document.createElement('div');
                div.className = `test-result ${result ? 'pass' : 'fail'}`;
                div.innerHTML = `${test.name}: ${result ? '‚úì PASS' : '‚úó FAIL'}`;
                results.appendChild(div);
            });
            
            const summary = document.createElement('div');
            summary.innerHTML = `<strong>Game State Tests: ${passed}/${tests.length} passed</strong>`;
            results.appendChild(summary);
        };

        window.testAIDecisions = function() {
            const results = document.getElementById('aiResults');
            results.innerHTML = '';
            
            const aiTests = [
                {
                    name: 'AI vstup do hry',
                    description: 'AI pot≈ôebuje min. 300 bod≈Ø pro vstup',
                    scenarios: [
                        { score: 250, hasEntered: false, shouldContinue: true },
                        { score: 300, hasEntered: false, shouldContinue: false }, // Pr√°vƒõ vstoupil
                        { score: 400, hasEntered: true, shouldContinue: false }   // Ji≈æ ve h≈ôe
                    ]
                },
                {
                    name: 'AI risk assessment',
                    description: 'AI rozhodov√°n√≠ na z√°kladƒõ poƒçtu kostek',
                    scenarios: [
                        { diceLeft: 6, riskLevel: 'N√≠zk√©' },
                        { diceLeft: 3, riskLevel: 'St≈ôedn√≠' },
                        { diceLeft: 1, riskLevel: 'Vysok√©' }
                    ]
                },
                {
                    name: 'Fin√°ln√≠ kolo strategie',
                    description: 'AI konzervativnost v posledn√≠m kole',
                    scenarios: [
                        { finalRound: true, leadingScore: 5000, myScore: 4500, needed: 550 },
                        { finalRound: false, leadingScore: 3000, myScore: 2500, needed: 'N/A' }
                    ]
                }
            ];
            
            let totalTests = 0;
            let passedTests = 0;
            
            aiTests.forEach(testGroup => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'scenario';
                groupDiv.innerHTML = `<strong>${testGroup.name}</strong><br>${testGroup.description}`;
                
                testGroup.scenarios.forEach((scenario, index) => {
                    totalTests++;
                    
                    // Simulace AI logiky
                    let passed = false;
                    if (testGroup.name.includes('vstup')) {
                        passed = scenario.hasEntered || scenario.score >= 300;
                    } else if (testGroup.name.includes('risk')) {
                        passed = true; // Z√°kladn√≠ risk assessment je implementov√°n
                    } else if (testGroup.name.includes('Fin√°ln√≠')) {
                        passed = scenario.finalRound ? scenario.needed < 1000 : true;
                    }
                    
                    if (passed) passedTests++;
                    
                    const scenarioDiv = document.createElement('div');
                    scenarioDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
                    scenarioDiv.innerHTML = `Sc√©n√°≈ô ${index + 1}: ${JSON.stringify(scenario)} ${passed ? '‚úì' : '‚úó'}`;
                    groupDiv.appendChild(scenarioDiv);
                });
                
                results.appendChild(groupDiv);
            });
            
            const summary = document.createElement('div');
            summary.innerHTML = `<strong>AI Tests: ${passedTests}/${totalTests} passed</strong>`;
            results.appendChild(summary);
        };
    </script>
</body>
</html>
