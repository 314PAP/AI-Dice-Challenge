<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎲 Test Herní Logiky - AI Kostková Výzva</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #111;
            color: #0f0;
            padding: 20px;
            margin: 0;
        }
        .test-section {
            border: 1px solid #0f0;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .test-passed {
            background: rgba(0, 255, 0, 0.1);
            border-color: #0f0;
        }
        .test-failed {
            background: rgba(255, 0, 0, 0.1);
            border-color: #f00;
            color: #f00;
        }
        .dice-test {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .dice {
            width: 50px;
            height: 50px;
            border: 2px solid #0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            background: #222;
        }
        .dice.selected {
            background: #0f0;
            color: #000;
        }
        .dice.scoring {
            border-color: #ff0;
            color: #ff0;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
        }
        #log {
            background: #000;
            border: 1px solid #0f0;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            font-size: 12px;
        }
        .controls {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>🎲 Test Herní Logiky - AI Kostková Výzva</h1>
    
    <div class="test-section" id="importTest">
        <h3>📦 Test importů modulů</h3>
        <div id="importResults">Testování...</div>
    </div>
    
    <div class="test-section" id="gameStateTest">
        <h3>🎮 Test herního stavu</h3>
        <div id="gameStateResults">Testování...</div>
    </div>
    
    <div class="test-section" id="diceTest">
        <h3>🎲 Test kostek a výběru</h3>
        <div class="controls">
            <button onclick="testDiceRoll()">🎲 Test hodu kostek</button>
            <button onclick="testDiceSelection()">✋ Test výběru kostek</button>
            <button onclick="testBankDice()">💰 Test odložení kostek</button>
        </div>
        <div id="diceContainer" class="dice-test"></div>
        <div id="diceResults">Připraven na testování...</div>
    </div>
    
    <div class="test-section" id="chatTest">
        <h3>💬 Test chatu</h3>
        <div class="controls">
            <button onclick="testChat()">💬 Test chat zprávy</button>
        </div>
        <div id="chatResults">Připraven na testování...</div>
    </div>
    
    <div class="test-section" id="gameFlowTest">
        <h3>🔄 Test herního toku</h3>
        <div class="controls">
            <button onclick="testGameStart()">▶️ Test spuštění hry</button>
            <button onclick="testTurnEnd()">⏭️ Test konce tahu</button>
            <button onclick="testGameReset()">🔄 Test reset hry</button>
        </div>
        <div id="gameFlowResults">Připraven na testování...</div>
    </div>
    
    <div id="log"></div>

    <script type="module">
        // Simulace game state pro test
        let testGameState = {
            currentPlayer: 0,
            diceValues: [],
            selectedDice: [],
            availableDice: 6,
            mustBankDice: false,
            gameStarted: false,
            players: [
                { name: 'Hráč', score: 0, type: 'human' },
                { name: 'Gemini', score: 0, type: 'gemini' },
                { name: 'ChatGPT', score: 0, type: 'chatgpt' },
                { name: 'Claude', score: 0, type: 'claude' }
            ]
        };

        function log(message) {
            const logElement = document.getElementById('log');
            logElement.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function setTestResult(sectionId, passed, message) {
            const section = document.getElementById(sectionId);
            const resultDiv = document.getElementById(sectionId.replace('Test', 'Results'));
            
            if (passed) {
                section.className = 'test-section test-passed';
                resultDiv.innerHTML = `✅ ${message}`;
            } else {
                section.className = 'test-section test-failed';
                resultDiv.innerHTML = `❌ ${message}`;
            }
            log(`${sectionId}: ${passed ? 'PASSED' : 'FAILED'} - ${message}`);
        }

        // Test importů
        async function testImports() {
            try {
                log('🔍 Testování importů...');
                
                const { gameState } = await import('./src/js/game/gameState.js');
                const { rollDice, calculateScore } = await import('./src/js/game/diceLogic.js');
                const { rollDiceForPlayer, selectDie, bankSelectedDice } = await import('./src/js/game/controllers/turnActionsController.js');
                
                log('✅ Všechny moduly úspěšně importovány');
                setTestResult('importTest', true, 'Všechny potřebné moduly jsou dostupné');
                
                // Uložíme reference pro další testy
                window.testModules = {
                    gameState,
                    rollDice,
                    calculateScore,
                    rollDiceForPlayer,
                    selectDie,
                    bankSelectedDice
                };
                
                return true;
            } catch (error) {
                log(`❌ Chyba při importování: ${error.message}`);
                setTestResult('importTest', false, `Chyba importu: ${error.message}`);
                return false;
            }
        }

        // Test herního stavu
        function testGameState() {
            try {
                const { gameState } = window.testModules;
                
                log('🔍 Testování herního stavu...');
                log(`Current player: ${gameState.currentPlayer}`);
                log(`Game started: ${gameState.gameStarted}`);
                log(`Available dice: ${gameState.availableDice}`);
                
                setTestResult('gameStateTest', true, `Herní stav je dostupný. Aktuální hráč: ${gameState.currentPlayer}`);
                return true;
            } catch (error) {
                log(`❌ Chyba v herním stavu: ${error.message}`);
                setTestResult('gameStateTest', false, `Chyba herního stavu: ${error.message}`);
                return false;
            }
        }

        // Test hodu kostek
        window.testDiceRoll = function() {
            try {
                const { rollDice, calculateScore } = window.testModules;
                
                log('🎲 Testování hodu kostek...');
                const diceResults = rollDice(5);
                const diceValues = diceResults.map(d => d.value);
                
                log(`Hod: ${diceValues.join(', ')}`);
                
                const score = calculateScore(diceValues);
                log(`Možné body: ${score}`);
                
                // Aktualizuj test state
                testGameState.diceValues = diceValues;
                testGameState.selectedDice = [];
                testGameState.mustBankDice = score > 0;
                
                // Zobraz kostky
                displayTestDice(diceValues);
                
                setTestResult('diceTest', true, `Hod: [${diceValues.join(', ')}], Možné body: ${score}`);
            } catch (error) {
                log(`❌ Chyba při hodu kostek: ${error.message}`);
                setTestResult('diceTest', false, `Chyba hodu: ${error.message}`);
            }
        };

        // Zobrazení kostek pro test
        function displayTestDice(diceValues) {
            const container = document.getElementById('diceContainer');
            container.innerHTML = '';
            
            diceValues.forEach((value, index) => {
                const dieElement = document.createElement('div');
                dieElement.className = 'dice';
                dieElement.textContent = value;
                dieElement.onclick = () => testSelectDie(index);
                
                const { calculateScore } = window.testModules;
                if (calculateScore([value]) > 0) {
                    dieElement.classList.add('scoring');
                }
                
                container.appendChild(dieElement);
            });
        }

        // Test výběru kostky
        function testSelectDie(index) {
            log(`🎯 Výběr kostky ${index} (hodnota: ${testGameState.diceValues[index]})`);
            
            if (testGameState.selectedDice.includes(index)) {
                testGameState.selectedDice = testGameState.selectedDice.filter(i => i !== index);
                log(`Kostka ${index} odznačena`);
            } else {
                testGameState.selectedDice.push(index);
                log(`Kostka ${index} označena`);
            }
            
            // Aktualizuj zobrazení
            const diceElements = document.querySelectorAll('.dice');
            diceElements.forEach((element, i) => {
                if (testGameState.selectedDice.includes(i)) {
                    element.classList.add('selected');
                } else {
                    element.classList.remove('selected');
                }
            });
            
            log(`Označené kostky: [${testGameState.selectedDice.join(', ')}]`);
        }

        // Test výběru kostek
        window.testDiceSelection = function() {
            if (testGameState.diceValues.length === 0) {
                setTestResult('diceTest', false, 'Nejprve proveďte hod kostek');
                return;
            }
            
            log('✋ Testování výběru kostek...');
            log('Klikněte na kostky pro jejich výběr/odznačení');
            setTestResult('diceTest', true, 'Výběr kostek je aktivní - klikněte na kostky');
        };

        // Test odložení kostek
        window.testBankDice = function() {
            try {
                if (testGameState.selectedDice.length === 0) {
                    setTestResult('diceTest', false, 'Nejprve vyberte kostky');
                    return;
                }
                
                const { calculateScore } = window.testModules;
                const selectedValues = testGameState.selectedDice.map(i => testGameState.diceValues[i]);
                const score = calculateScore(selectedValues);
                
                log(`💰 Odložení kostek: [${selectedValues.join(', ')}]`);
                log(`Získané body: ${score}`);
                
                if (score > 0) {
                    testGameState.bankedDiceThisTurn = (testGameState.bankedDiceThisTurn || []).concat(selectedValues);
                    testGameState.selectedDice = [];
                    setTestResult('diceTest', true, `Kostky odloženy za ${score} bodů`);
                } else {
                    setTestResult('diceTest', false, 'Vybrané kostky nemají žádnou hodnotu');
                }
            } catch (error) {
                log(`❌ Chyba při odložení kostek: ${error.message}`);
                setTestResult('diceTest', false, `Chyba odložení: ${error.message}`);
            }
        };

        // Test chatu
        window.testChat = function() {
            try {
                log('💬 Testování chatu...');
                
                if (typeof window.addChatMessage === 'function') {
                    window.addChatMessage('system', '🧪 Test zpráva ze systému');
                    window.addChatMessage('human', '🧪 Test zpráva od hráče');
                    setTestResult('chatTest', true, 'Chat funkce je dostupná a funkční');
                } else {
                    setTestResult('chatTest', false, 'Chat funkce není dostupná');
                }
            } catch (error) {
                log(`❌ Chyba chatu: ${error.message}`);
                setTestResult('chatTest', false, `Chyba chatu: ${error.message}`);
            }
        };

        // Test spuštění hry
        window.testGameStart = async function() {
            try {
                log('▶️ Testování spuštění hry...');
                
                const { startGame } = await import('./src/js/game/controllers/gameFlowController.js');
                
                // Simulace spuštění hry
                log('Spouštění hry...');
                setTestResult('gameFlowTest', true, 'Funkce startGame je dostupná');
            } catch (error) {
                log(`❌ Chyba spuštění hry: ${error.message}`);
                setTestResult('gameFlowTest', false, `Chyba spuštění: ${error.message}`);
            }
        };

        // Test konce tahu
        window.testTurnEnd = async function() {
            try {
                log('⏭️ Testování konce tahu...');
                
                const { nextPlayer } = await import('./src/js/game/controllers/gameFlowController.js');
                
                log('Funkce nextPlayer je dostupná');
                setTestResult('gameFlowTest', true, 'Funkce nextPlayer je dostupná');
            } catch (error) {
                log(`❌ Chyba konce tahu: ${error.message}`);
                setTestResult('gameFlowTest', false, `Chyba konce tahu: ${error.message}`);
            }
        };

        // Test reset hry
        window.testGameReset = async function() {
            try {
                log('🔄 Testování resetu hry...');
                
                const { resetGame } = await import('./src/js/game/controllers/gameFlowController.js');
                
                log('Funkce resetGame je dostupná');
                setTestResult('gameFlowTest', true, 'Funkce resetGame je dostupná');
            } catch (error) {
                log(`❌ Chyba resetu hry: ${error.message}`);
                setTestResult('gameFlowTest', false, `Chyba resetu: ${error.message}`);
            }
        };

        // Spuštění všech testů při načtení
        async function runAllTests() {
            log('🚀 Spouštění testů herní logiky...');
            
            const importsOK = await testImports();
            if (importsOK) {
                testGameState();
            }
        }

        // Spuštění testů
        runAllTests();
    </script>
</body>
</html>
