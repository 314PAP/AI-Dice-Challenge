<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≤ AI Kostkov√° V√Ωzva</title>
    <link rel="icon" type="image/svg+xml" href="/dice.svg" />
    
    <!-- CSS stylov√°n√≠ - Modul√°rn√≠ struktura -->
    <link rel="stylesheet" href="/src/styles/base/reset.css">
    <link rel="stylesheet" href="/src/styles/themes/neon.css">
    <link rel="stylesheet" href="/src/styles/base/layout.css">
    <link rel="stylesheet" href="/src/styles/components/buttons.css">
    <link rel="stylesheet" href="/src/styles/components/players.css">
    <link rel="stylesheet" href="/src/styles/components/chat.css">
    <link rel="stylesheet" href="/src/styles/components/dice.css">
    
    <style>
        /* Dodateƒçn√© styly pro layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            min-height: 100vh;
        }

        .game-area {
            background: var(--black-bg);
            border: 2px solid var(--neon-green);
            border-radius: 10px;
            padding: 30px;
        }

        .game-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 30px;
            color: var(--neon-green);
            letter-spacing: 2px;
        }

        .target-score-setup {
            text-align: center;
            margin-bottom: 30px;
        }

        .target-score-setup label {
            color: var(--neon-green);
            font-weight: 700;
            display: block;
            margin-bottom: 15px;
        }

        .target-score-setup input {
            background: var(--black-bg);
            border: 2px solid var(--neon-green);
            color: var(--neon-green);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Orbitron', monospace;
            margin: 0 10px;
            width: 120px;
        }

        .game-controls {
            text-align: center;
        }

        .turn-info, .current-turn-score, .target-info {
            color: var(--neon-green);
            font-weight: 700;
            margin: 10px 0;
            font-size: 16px;
        }

        .roll-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .players-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .player {
            background: var(--black-bg);
            border: 2px solid var(--neon-green);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-width: 120px;
        }

        .player.active {
            border-color: var(--neon-orange);
            box-shadow: 0 0 15px var(--neon-orange);
        }

        .player-head img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--neon-green);
        }

        .player-name, .player-score {
            color: var(--neon-green);
            font-weight: 700;
            margin: 5px 0;
        }

        .chat-panel {
            background: var(--black-bg);
            border: 2px solid var(--neon-blue);
            border-radius: 10px;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .coffee-link {
            display: block;
            text-align: center;
            margin: 20px 0;
            color: var(--neon-green);
            text-decoration: none;
            font-weight: 700;
        }

        .coffee-link:hover {
            color: var(--neon-orange);
        }

        /* Modal styly */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .modal-content {
            background: var(--black-bg);
            border: 2px solid var(--neon-green);
            border-radius: 10px;
            margin: 5% auto;
            padding: 30px;
            width: 80%;
            max-width: 600px;
            color: var(--neon-green);
        }

        .modal-header h2 {
            color: var(--neon-green);
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-actions {
            text-align: center;
            margin-top: 20px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .players-container {
                gap: 10px;
            }
            
            .roll-controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-area">
            <div class="game-header">
                <h1 class="game-title"><span class="neon-icon">üé≤</span> AI Kostkov√° V√Ωzva</h1>
                <div class="target-score-setup" id="targetScoreSetup">
                    <label>C√≠lov√© sk√≥re: <input type="number" id="targetScoreInput" value="10000" min="1000" step="1000"></label>
                    <button class="btn btn-primary" id="startGameBtn">Zaƒç√≠t hru</button>
                    <button class="btn btn-secondary" onclick="displayHallOfFame()" style="margin-left: 10px;">üèÜ S√≠≈à sl√°vy</button>
                </div>
                
                <a href="https://buymeacoffee.com/pipap" target="_blank" class="coffee-link">
                    <span class="neon-icon">‚òï</span> Kup mi k√°vu
                </a>
            </div>

            <div class="players-container">
                <div class="player human-player active">
                    <div class="player-head">
                        <img src="/ai-icons/mind.jpeg" alt="Vy" />
                    </div>
                    <div class="player-name">Vy</div>
                    <div class="player-score">Sk√≥re: <span id="humanScore">0</span></div>
                </div>
                <div class="player gemini-player">
                    <div class="player-head">
                        <img src="/ai-icons/gemini.jpeg" alt="Gemini" />
                    </div>
                    <div class="player-name">Gemini</div>
                    <div class="player-score">Sk√≥re: <span id="geminiScore">0</span></div>
                </div>
                <div class="player chatgpt-player">
                    <div class="player-head">
                        <img src="/ai-icons/gpt.jpeg" alt="ChatGPT" />
                    </div>
                    <div class="player-name">ChatGPT</div>
                    <div class="player-score">Sk√≥re: <span id="chatgptScore">0</span></div>
                </div>
                <div class="player claude-player">
                    <div class="player-head">
                        <img src="/ai-icons/claude.jpeg" alt="Claude" />
                    </div>
                    <div class="player-name">Claude</div>
                    <div class="player-score">Sk√≥re: <span id="claudeScore">0</span></div>
                </div>
            </div>

            <div class="game-controls" id="gameControls" style="display: none;">
                <div class="turn-info" id="turnInfo">V√°≈° tah!</div>
                <div class="current-turn-score" id="currentTurnScore">Sk√≥re tahu: 0</div>
                <div class="target-info" id="targetInfo">
                    C√≠l: <span id="targetScoreDisplay">10000</span>
                </div>
                
                <div class="dice-container" id="diceContainer"></div>
                
                <div class="roll-controls">
                    <button class="btn btn-primary" id="rollBtn">Hodit kostky</button>
                    <button class="btn btn-secondary" id="bankBtn" disabled>Odlo≈æit vybran√©</button>
                    <button class="btn btn-warning" id="endTurnBtn" disabled>Ukonƒçit tah</button>
                    <button class="btn btn-danger" id="quitGameBtn">Opustit hru</button>
                </div>
            </div>
        </div>

        <div class="chat-panel">
            <div class="chat-header">
                <h2>üí¨ Chat s AI</h2>
            </div>
            
            <div class="chat-messages" id="chatMessages"></div>
            
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Napi≈°te zpr√°vu..." maxlength="200">
                <button id="sendMessageBtn">‚û§</button>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üéÆ Konec hry</h2>
            </div>
            <div class="modal-body">
                <div id="winnerAnnouncement" class="winner-announcement"></div>
                <div id="finalScores" class="final-scores"></div>
                <div id="gameStats" class="game-stats"></div>
                
                <!-- Signature section for human winners -->
                <div id="signatureSection" class="signature-section" style="display: none;">
                    <h3>üèÜ Gratulujeme k v√≠tƒõzstv√≠!</h3>
                    <p>Zadejte sv≈Øj podpis pro z√°pis do s√≠nƒõ sl√°vy:</p>
                    <div class="signature-input">
                        <input type="text" id="winnerSignature" placeholder="V√°≈° podpis" maxlength="30">
                        <button onclick="saveScore()" class="btn btn-success">üíæ Ulo≈æit sk√≥re</button>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button onclick="displayHallOfFame()" class="btn btn-primary">üèÜ Zobrazit s√≠≈à sl√°vy</button>
                    <button onclick="startNewGame()" class="btn btn-secondary">üîÑ Nov√° hra</button>
                    <button onclick="returnToMainMenu()" class="btn btn-secondary">üè† Hlavn√≠ menu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hall of Fame Modal -->
    <div id="hallOfFameModal" class="modal" style="display: none;">
        <div class="modal-content hall-of-fame-content">
            <div class="modal-header">
                <h2>üèÜ S√≠≈à sl√°vy</h2>
            </div>
            <div class="modal-body">
                <div id="hallOfFameContent">
                    <div id="hallOfFameList"></div>
                </div>
                <div class="modal-actions">
                    <button onclick="closeHallOfFame()" class="btn btn-secondary">‚úñÔ∏è Zav≈ô√≠t</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        console.log('üé≤ AI Kostkov√° V√Ωzva - Loading...');
        
        // Import hlavn√≠ho game controlleru a chat syst√©mu
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('‚úÖ DOM loaded, initializing game...');
            
            try {
                // Import modul√°rn√≠ho syst√©mu
                const { MainGameController } = await import('/src/game/mainGameController.js');
                
                // Inicializuj hlavn√≠ game controller
                const gameController = new MainGameController();
                await gameController.initialize();
                
                console.log('‚úÖ Game controller initialized successfully!');
                
                // Setup chat functionality
                const sendBtn = document.getElementById('sendMessageBtn');
                const chatInput = document.getElementById('chatInput');
                
                if (sendBtn && chatInput) {
                    sendBtn.addEventListener('click', () => {
                        const message = chatInput.value.trim();
                        if (message) {
                            addChatMessage('Vy', message);
                            chatInput.value = '';
                            
                            // Simple AI response
                            setTimeout(() => {
                                const responses = [
                                    'üìä Zaj√≠mav√° statistika! Analyzuji data...',
                                    '‚ö° O tom pr√°vƒõ mluv√≠m! P≈ôiprav se na por√°≈æku!',
                                    'üßò Zamysli se nad hlub≈°√≠m v√Ωznamem sv√© strategie...',
                                    'üé≤ Nech kostky rozhodnout o tv√©m osudu!'
                                ];
                                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                                const aiNames = ['Gemini', 'ChatGPT', 'Claude'];
                                const randomAI = aiNames[Math.floor(Math.random() * aiNames.length)];
                                addChatMessage(randomAI, randomResponse);
                            }, 1000 + Math.random() * 1000);
                        }
                    });
                    
                    chatInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            sendBtn.click();
                        }
                    });
                }
                
                // Setup hall of fame
                window.displayHallOfFame = () => {
                    const modal = document.getElementById('hallOfFameModal');
                    if (modal) {
                        modal.style.display = 'block';
                        addChatMessage('Syst√©m', 'üèÜ S√≠≈à sl√°vy zobrazena');
                    }
                };
                
                window.closeHallOfFame = () => {
                    const modal = document.getElementById('hallOfFameModal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                };
                
                // Setup game over modal
                window.closeGameOverModal = () => {
                    const modal = document.getElementById('gameOverModal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                };
                
                // Welcome message
                setTimeout(() => {
                    addChatMessage('Syst√©m', 'üé≤ V√≠tejte v AI Kostkov√© v√Ωzvƒõ! Nastavte c√≠lov√© sk√≥re a zaƒçnƒõte hr√°t!');
                }, 500);
                
            } catch (error) {
                console.error('‚ùå Error initializing game:', error);
                
                // Fallback functionality
                setupBasicFallback();
            }
        });
        
        // Fallback pro z√°kladn√≠ funkcionalitu
        function setupBasicFallback() {
            console.log('üîÑ Setting up basic fallback functionality...');
            
            document.getElementById('startGameBtn')?.addEventListener('click', () => {
                document.getElementById('targetScoreSetup').style.display = 'none';
                document.getElementById('gameControls').style.display = 'block';
                addChatMessage('Syst√©m', 'üéÆ Hra spu≈°tƒõna (z√°kladn√≠ re≈æim)!');
            });
            
            document.getElementById('quitGameBtn')?.addEventListener('click', () => {
                if (confirm('Opravdu chcete opustit hru?')) {
                    document.getElementById('gameControls').style.display = 'none';
                    document.getElementById('targetScoreSetup').style.display = 'block';
                    addChatMessage('Syst√©m', 'üö™ Hra byla opu≈°tƒõna');
                }
            });
        }
        
        // Chat message funkce
        function addChatMessage(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="message-sender">${sender}</span>
                    <span class="message-time">${new Date().toLocaleTimeString()}</span>
                </div>
                <div class="message-content">${message}</div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Make functions global
        window.addChatMessage = addChatMessage;
        
        console.log('‚úÖ AI Kostkov√° V√Ωzva ready!');
    </script>
    
    <!-- Backup inline script for debugging -->
    <script>
        console.log('üîß Backup script loading...');
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîß DOM loaded, backup listeners ready...');
            
            // Extra backup start game listener
            const startBtn = document.getElementById('startGameBtn');
            if (startBtn && !startBtn.hasAttribute('data-backup-added')) {
                startBtn.setAttribute('data-backup-added', 'true');
                startBtn.addEventListener('click', () => {
                    console.log('üöÄ Backup start button activated!');
                    const setup = document.getElementById('targetScoreSetup');
                    const controls = document.getElementById('gameControls');
                    if (setup && controls) {
                        setup.style.display = 'none';
                        controls.style.display = 'block';
                    }
                });
            }
        });
    </script>
</body>
</html>
